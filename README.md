# StingrayTV Alice - управление приёмником Триколора с помощью "Дома с Алисой"

## Описание

Проект предоставляет интеграцию приёмника Триколора через сервис "Дом с Алисой".
Пользователи могут управлять своим приёмником голосом через Алису.

## Особенности

- Управление спутниковым ресивером Триколора через голосовые команды
- Интеграция с API Умного дома Яндекса
- Безопасная авторизация через Keycloak
- Поддержка всех основных операций: получение списка устройств, запрос состояния, выполнение действий
- Поддержка разъединения аккаунтов

## Быстрый старт

### Процесс авторизации

1. Пользователь нажимает "Привязать к Яндексу" в приложении "Дом с Алисой"
2. Яндекс перенаправляет на страницу авторизации
3. Пользователь соглашается с авторизацией
4. Яндекс обменивает код на JWT токен
5. Токен используется для доступа к API навыка

### Требования

- Java 21
- Docker (для запуска через контейнеры)
- Доступ к ресиверу Триколора (IP-адрес и порт, либо автоматическое обнаружение через mDNS)

### Установка и запуск

#### Запуск через Docker

Для запуска через Docker выполните:

1. Склонируйте репозиторий
2. Настройте переменные окружения в файле `.env` в корне репозитория
3. Запустите команду:

   ```bash
   docker-compose up
   ```

## Безопасность

Используется Keycloak, с авторизацией клиента через client_id + токен, и с интеграцией со Spring через Spring OAuth2 Resource Server.

## API эндпоинты

### Умный дом Яндекса

- `GET /v1.0/user/devices` - получение списка устройств
- `POST /v1.0/user/devices/query` - запрос состояния устройств
- `POST /v1.0/user/devices/action` - выполнение действий с устройствами
- `POST /v1.0/user/unlink` - оповещение о разъединении аккаунтов
- `HEAD /v1.0` - проверка состояния сервиса

## Технологии

- **Java 25**
- **Spring Boot**
- **Spring Security**
- **Keycloak**
- **Gradle**
- **Docker**
- **API Умного дома Яндекса**

## Лицензия

GPLv3
